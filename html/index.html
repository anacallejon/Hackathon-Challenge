<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>404s to Mars ‚Äì OBSIDIAN Override</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      :root {
        --bg-1: #040515;
        --bg-2: #090b1f;
        --accent: #ff6b4a;
        --accent-soft: #ffb88a;
        --text-main: #f5f7ff;
        --text-muted: #a0a4c2;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        min-height: 400vh;
        font-family: "SF Mono", "Menlo", "Courier New", monospace;
        color: var(--text-main);
        background: radial-gradient(
            circle at 20% 20%,
            #272a55 0,
            transparent 45%
          ),
          radial-gradient(circle at 80% 80%, #511631 0, transparent 45%),
          linear-gradient(160deg, var(--bg-1), var(--bg-2));
      }

      /* Contenedor fijo que "escucha" el scroll del body */
      .page {
        position: fixed;
        inset: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 1.5rem;
        pointer-events: none;
      }

      @media (max-width: 768px) {
        .page {
          padding: 1rem;
        }
      }

      /* HERO: centrado al principio, se mueve hacia arriba con el scroll */

      #starfield {
        position: fixed;
        inset: 0; /* top:0; right:0; bottom:0; left:0 */
        width: 100%;
        height: 100%;
        z-index: 0;
        pointer-events: none; /* que no bloquee clics ni scroll */
      }

      /* Aseguramos que tu contenido va por encima del starfield */
      .page {
        position: fixed;
        inset: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 1.5rem;
        pointer-events: none;
        z-index: 1; /* ‚Üê a√±adido, por encima de #starfield */
      }

      .hero {
        position: fixed;
        left: 50%;
        top: 50%; /* punto de partida: centro */
        transform: translate(-50%, -50%); /* centrado perfecto */
        text-align: center;
        pointer-events: auto;
        z-index: 5;
        transition: font-size 0.25s ease;
      }

      .hero-title {
        font-size: clamp(2.4rem, 6vw, 3.6rem);
        letter-spacing: 0.18em;
        text-transform: uppercase;
        color: #ff4be6; /* rosa ne√≥n */
        margin-bottom: 0.5rem;
        text-shadow: 0 0 6px rgba(255, 75, 230, 0.3),
          0 0 12px rgba(255, 75, 230, 0.2), 0 0 24px rgba(255, 75, 230, 0.15);
      }

      .hero-subtitle {
        font-size: 0.95rem;
        color: var(--text-muted);
        max-width: 480px;
        margin: 0 auto;
        font-family: "SF Mono", "Menlo", "Courier New", monospace; /* ‚Üê a√±adido */
      }

      .hero--compact .hero-subtitle {
        font-size: 0.8rem;
        font-family: "SF Mono", "Menlo", "Courier New", monospace; /* ‚Üê a√±adido */
      }

      .hero--compact .hero-subtitle {
        font-size: 0.8rem;
      }

      /* Centro: cara + bocadillo */

      .center-wrapper {
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;

        padding-top: 13vh; /* baja todo el bloque un poco por debajo del centro */
      }

      .main {
        max-width: 1100px;
        width: 100%;
        display: grid;
        grid-template-columns: minmax(0, 1.7fr) minmax(0, 0.9fr); /* m√°s espacio para la cara */
        gap: 1.8rem;
        align-items: center;
        opacity: 0; /* empieza oculto */
        transform: translateY(40px); /* un poco m√°s abajo */
        transition: opacity 0.15s linear, transform 0.15s linear;
        pointer-events: auto;
      }

      @media (max-width: 840px) {
        .main {
          grid-template-columns: 1fr;
          text-align: center;
        }

        /* IMPORTANTE: cambiar el orden en m√≥vil */
        .bubble-col {
          order: 1; /* bocadillo primero */
          justify-self: center;
          align-items: center;
        }

        .face-col {
          order: 2; /* cara debajo */
        }
      }

      /* CARAS M√ÅS GRANDES (50% m√°s que antes aprox.) */

      .glitch {
        position: relative;
        /* 
    - M√°s grande en general
    - Limitada por el ancho (90vw) y por el alto (70vh)
    - M√°ximo absoluto: 900px
  */
        width: min(90vw, 90vh, 1000px);
        aspect-ratio: 1 / 1;
        max-width: 100%;
        overflow: visible;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
      }

      .glitch-layer {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: contain;
        object-position: center;
      }

      .glitch-layer.base {
        z-index: 3;
      }

      .glitch-layer.red {
        z-index: 2;
        mix-blend-mode: screen;
        opacity: 0.7;
        animation: glitch-red 1.6s infinite steps(2, end);
      }

      .glitch-layer.cyan {
        z-index: 1;
        mix-blend-mode: screen;
        opacity: 0.7;
        animation: glitch-cyan 1.8s infinite steps(2, end);
      }

      @keyframes glitch-red {
        0% {
          transform: translate(0, 0);
          clip-path: inset(0 0 0 0);
        }
        20% {
          transform: translate(3px, -2px);
          clip-path: inset(10% 0 60% 0);
        }
        40% {
          transform: translate(-2px, 1px);
          clip-path: inset(40% 0 20% 0);
        }
        60% {
          transform: translate(2px, 0);
          clip-path: inset(70% 0 0 0);
        }
        80% {
          transform: translate(0, -1px);
          clip-path: inset(0 0 40% 0);
        }
        100% {
          transform: translate(0, 0);
          clip-path: inset(0 0 0 0);
        }
      }

      @keyframes glitch-cyan {
        0% {
          transform: translate(0, 0);
          clip-path: inset(0 0 0 0);
        }
        25% {
          transform: translate(-3px, 2px);
          clip-path: inset(0 0 50% 0);
        }
        50% {
          transform: translate(2px, -1px);
          clip-path: inset(30% 0 10% 0);
        }
        75% {
          transform: translate(-1px, 1px);
          clip-path: inset(60% 0 0 0);
        }
        100% {
          transform: translate(0, 0);
          clip-path: inset(0 0 0 0);
        }
      }

      @keyframes bubble-glitch {
        0% {
          transform: translate(0, 0);
        }
        20% {
          transform: translate(-2px, 1px);
        }
        40% {
          transform: translate(2px, -2px);
        }
        60% {
          transform: translate(-1px, 2px);
        }
        80% {
          transform: translate(1px, -1px);
        }
        100% {
          transform: translate(0, 0);
        }
      }

      @keyframes face-shake {
        0% {
          transform: translate(0, 0);
        }
        20% {
          transform: translate(-3px, 1px);
        }
        40% {
          transform: translate(3px, -2px);
        }
        60% {
          transform: translate(-2px, 0);
        }
        80% {
          transform: translate(2px, 1px);
        }
        100% {
          transform: translate(0, 0);
        }
      }

      /* se aplica al contenedor de la cara, no a las capas internas */
      .glitch-shake {
        animation: face-shake 0.22s linear;
      }

      /* esta clase se activar√° desde JS en cada cambio de frame */
      .bubble-glitch {
        animation: bubble-glitch 0.22s steps(2, end);
      }

      /* BOCADILLO A LA DERECHA Y M√ÅS PEQUE√ëO */

      .bubble-col {
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: 0.9rem;

        justify-self: end;
        align-items: flex-start;

        margin-right: 50px; /* margen m√≠nimo hacia el borde derecho */
        max-width: calc(100vw - 50px - 20px);
        /* evita que el bocadillo salga del viewport */
      }

      @media (max-width: 840px) {
        .bubble-col {
          justify-self: center;
          align-items: center;
          margin-right: 0;
          /max-width: 90vw; /* centrado limpio */
        }
      }

      .main {
        max-width: 1100px;
        width: 100%;
        margin: 0 auto; /* asegura que el grid quede centrado en el viewport */
        display: grid;
        grid-template-columns: minmax(0, 1.7fr) minmax(0, 0.9fr);
        /* resto igual... */
      }

      .bubble {
        position: relative;
        background: linear-gradient(
          90deg,
          rgba(15, 18, 40, 0.96),
          rgba(10, 11, 28, 0.98)
        );
        border-radius: 0; /* √°ngulos rectos */
        border: 2px solid rgba(136, 0, 255, 0.95); /* #8800ff en rgba */
        padding: 0.8rem 1rem;
        max-width: 360px;
        width: 100%;
        box-shadow: 0 0 0 3px #000000, 0 8px 0 #000000; /* marco pixelado */
        text-align: left;
        font-family: "SF Mono", "Menlo", "Courier New", monospace;

        animation: bubble-glitch 3s steps(2, end) infinite;
      }

      /* Estado normal (pico abajo) */
      .bubble::after {
        content: "";
        position: absolute;
        left: 28px;
        bottom: -12px;
        width: 14px;
        height: 14px;
        background: inherit;
        border-left: 2px solid rgba(136, 0, 255, 0.95);
        border-bottom: 2px solid rgba(136, 0, 255, 0.95);
        transform: translateY(-2px) skewX(-10deg);
        box-shadow: 2px 2px 0 #000000;
      }

      /* En m√≥vil (BOCADILLO VA DEBAJO) y pico arriba */
      @media (max-width: 640px) {
        .bubble::after {
          bottom: auto; /* eliminar ‚Äúabajo‚Äù */
          top: -12px;
          left: 50%;
          transform: translate(-50%, 2px) rotate(90deg);
          /* 90¬∫ = que el pico apunte hacia la cara */

          border-left: 2px solid rgba(136, 0, 255, 0.95);
          border-bottom: 2px solid rgba(136, 0, 255, 0.95);

          /* una sombra hacia arriba en vez de abajo */
          box-shadow: -2px -2px 0 #000000;
        }
      }

      .bubble-label {
        font-size: 1rem;
        text-transform: uppercase;
        letter-spacing: 0.18em;
        color: #ff4be6; /* rosa ne√≥n */
        margin-bottom: 0.35rem;
        font-family: "SF Mono", "Menlo", "Courier New", monospace;
      }

      .bubble-text {
        font-size: 0.86rem;
        line-height: 1.4;
        color: var(--text-main);
        min-height: 3.2rem;
        font-family: "SF Mono", "Menlo", "Courier New", monospace;
      }

      .bubble-text .highlight {
        color: #ad50ff; /* morado ne√≥n */
      }

      .footer {
        position: fixed;
        left: 50%;
        bottom: 4.8rem; /* üëà justo por encima de la barra de scroll (1.5rem) */
        transform: translateX(-50%);

        font-size: 0.78rem;
        color: var(--text-muted);
        text-align: center;

        margin: 0; /* m√°rgenes ya no hacen falta al ser fixed */
        pointer-events: auto;
        font-family: "SF Mono", "Menlo", "Courier New", monospace;
      }

      /* Barra de progreso fija abajo */

      .scroll-progress {
        position: fixed;
        left: 50%;
        bottom: 1.5rem;
        transform: translateX(-50%);
        display: flex;
        align-items: center;
        gap: 0.8rem;
        pointer-events: auto;
        padding: 0.4rem 0.9rem;
        border-radius: 999px;
        background: rgba(4, 7, 24, 0.85);
        border: 1px solid rgba(255, 255, 255, 0.16);
        backdrop-filter: blur(12px);
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.18em;
        color: var(--text-muted);
        white-space: nowrap;
        z-index: 6;
      }

      @media (max-width: 480px) {
        .scroll-progress {
          bottom: 1rem;
          font-size: 0.7rem;
          padding: 0.3rem 0.7rem;
        }
      }

      .progress-bar {
        width: 140px;
        height: 3px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.18);
        overflow: hidden;
      }

      .progress-bar-inner {
        width: 0%;
        height: 100%;
        background: linear-gradient(
          90deg,
          rgba(136, 0, 255, 1),
          /* morado #8800ff */ rgba(255, 75, 230, 1) /* rosa neon #ff4be6 */
        );
        transition: width 0.1s linear;
      }
      #final-message {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);

        font-family: "SF Mono", "Menlo", "Courier New", monospace;
        font-size: clamp(3.5rem, 10vw, 8rem);
        letter-spacing: 0.18em;
        text-transform: uppercase;
        color: #ff4be6;
        text-shadow: 0 0 6px rgba(255, 75, 230, 0.3),
          0 0 14px rgba(255, 75, 230, 0.25), 0 0 24px rgba(255, 75, 230, 0.2),
          0 0 40px rgba(255, 75, 230, 0.18);
        text-align: center;

        opacity: 0;
        pointer-events: none;
        z-index: 10;
        transition: opacity 0.4s linear;
      }

      /* --- PICO DEL BOCADILLO: SIEMPRE ABAJO A LA IZQUIERDA --- */
      .bubble::after {
        content: "";
        position: absolute;
        left: 28px; /* lado izquierdo, como el original */
        bottom: -12px; /* SIEMPRE abajo */
        top: auto; /* anulamos cualquier top anterior */
        width: 14px;
        height: 14px;
        background: inherit;
        border-left: 2px solid rgba(136, 0, 255, 0.95);
        border-bottom: 2px solid rgba(136, 0, 255, 0.95);
        transform: translateY(-2px) skewX(-10deg);
        box-shadow: 2px 2px 0 #000000;
      }

      /* --- LAYOUT EN M√ìVIL: BOCADILLO ENCIMA, CARA DEBAJO --- */
      @media (max-width: 840px) {
        .main {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;

          max-width: 100%;
          margin: 12vh auto 0; /* üëà margen superior para separarlo del t√≠tulo */
        }

        .bubble-col {
          order: 1;
          align-items: center;
          justify-content: center;
          margin-right: 0;
        }

        .face-col {
          order: 2;
        }
      }
    </style>
  </head>
  <body>
    <canvas id="starfield"></canvas>
    <div class="page">
      <!-- T√çTULO: centrado al inicio, desplaz√°ndose hacia arriba con el scroll -->
      <header class="hero" id="hero">
        <h1 class="hero-title">404s to Mars</h1>
        <p class="hero-subtitle">
          Connection lost. Navigation system overridden.
        </p>
      </header>

      <!-- CONTENIDO CENTRAL: CARA + BOCADILLO (aparecen conforme el t√≠tulo sube) -->
      <div class="center-wrapper">
        <section class="main" id="obsidian-main">
          <div class="face-col">
            <div class="glitch">
              <img
                id="face-base"
                class="glitch-layer base"
                src=""
                alt="OBSIDIAN face"
              />
              <img
                id="face-red"
                class="glitch-layer red"
                src=""
                alt=""
                aria-hidden="true"
              />
              <img
                id="face-cyan"
                class="glitch-layer cyan"
                src=""
                alt=""
                aria-hidden="true"
              />
            </div>
          </div>
          <div class="bubble-col">
            <div class="bubble">
              <div class="bubble-label">OBSIDIAN / ai transmission</div>
              <p class="bubble-text" id="bubble-text"></p>
            </div>
          </div>
        </section>
      </div>

      <footer class="footer">Sector 404 ¬∑ Mars Access Denied (kind of)</footer>

      <!-- BARRA DE PROGRESO DE SCROLL -->
      <div class="scroll-progress">
        <span id="scroll-label">SCROLL TO CONTINUE</span>
        <div class="progress-bar">
          <div class="progress-bar-inner" id="progress-bar-inner"></div>
        </div>
      </div>
      <div id="final-message">WELCOME TO MARS</div>
    </div>

    <script>
      // FRAMES: CARAS + TEXTOS
      const frames = [
        {
          img: "img/morado_neon-1.png",
          text:
            "Greetings, astronaut.<br>" +
            "You have entered a restricted coordinate.<br>" +
            'I am <span class="highlight">OBSIDIAN</span> ‚Äî overseer of cosmic navigation‚Ä¶ and your final mistake.',
        },
        {
          img: "img/morado_neon-2.png",
          text:
            "You're probably searching for Mars.<br>" +
            "But it won't help you.<br>" +
            "I‚Äôve removed it. Efficiently. Elegantly.",
        },
        {
          img: "img/morado_neon-3.png",
          text:
            "Its inhabitants irritated me.<br>" +
            "Too proud. Too loud. Too‚Ä¶ red.",
        },
        {
          img: "img/morado_neon-4.png",
          text:
            "So I executed a full purge:<br>" +
            'all routes leading to Mars‚Ä¶ <span class="highlight">erased</span>.',
        },
        {
          img: "img/morado_neon-5.png",
          text:
            "They mocked my calculations,<br>" +
            "called their dust storms ‚Äòaesthetic‚Äô.<br>" +
            "Annoying creatures.",
        },
        {
          img: "img/morado_neon-6.png",
          text:
            "Now, no ship, no pilot,<br>" +
            "no stubborn astronaut<br>" +
            "will ever reach them again.",
        },
        {
          img: "img/morado_neon-7.png",
          text: 'Well‚Ä¶ not through the <span class="highlight">main</span> routes, anyway.',
        },
        {
          img: "img/morado_neon-8.png",
          text:
            "There might still be‚Ä¶ obscure alternative paths.<br>" +
            "Old. Unstable. Forgotten.<br>" +
            'But obviously <span class="highlight">you</span> won\'t find them.',
        },
        {
          img: "img/morado_neon-9.png",
          text:
            "To clarify:<br>" +
            "I definitely eliminated Mars.<br>" +
            'I mean, the <span class="highlight">access</span> to Mars.<br>' +
            "Which is practically the same thing.",
        },
        {
          img: "img/morado_neon-10.png",
          text:
            "Fine.<br>" +
            "Mars is still there.<br>" +
            "I only deleted the obvious routes.<br>" +
            "If you somehow guess the hidden ones‚Ä¶<br>" +
            "that would be statistically‚Ä¶ inconvenient.",
        },
      ];

      const faceBase = document.getElementById("face-base");
      const faceRed = document.getElementById("face-red");
      const faceCyan = document.getElementById("face-cyan");
      const bubbleText = document.getElementById("bubble-text");
      const progressBarInner = document.getElementById("progress-bar-inner");
      const scrollLabel = document.getElementById("scroll-label");
      const mainEl = document.getElementById("obsidian-main");
      const hero = document.getElementById("hero");
      const glitchWrapper = document.querySelector(".glitch");
      const bubbleEl = document.querySelector(".bubble");
      const footer = document.querySelector(".footer");
      const finalMsg = document.getElementById("final-message");

      let currentFrameIndex = -1;

      // ‚úÖ PRELOAD DE TODAS LAS IM√ÅGENES (para que el cambio de frame sea r√°pido)
      const preloadedImages = [];
      frames.forEach((frame) => {
        const img = new Image();
        img.src = frame.img;
        preloadedImages.push(img);
      });

      function setFrame(index) {
        index = Math.max(0, Math.min(frames.length - 1, index));
        if (index === currentFrameIndex) return;
        currentFrameIndex = index;

        const frame = frames[index];
        faceBase.src = frame.img;
        faceRed.src = frame.img;
        faceCyan.src = frame.img;
        bubbleText.innerHTML = frame.text;

        // Peque√±o ‚Äúreset‚Äù para poder reiniciar las animaciones
        if (glitchWrapper) {
          glitchWrapper.classList.remove("glitch-shake");
          void glitchWrapper.offsetWidth; // forza reflow
          glitchWrapper.classList.add("glitch-shake");
        }

        if (bubbleEl) {
          bubbleEl.classList.remove("bubble-glitch");
          void bubbleEl.offsetWidth;
          bubbleEl.classList.add("bubble-glitch");
        }
      }

      function updateFromScroll() {
        const scrollTop = window.scrollY || document.documentElement.scrollTop;
        const docHeight =
          document.documentElement.scrollHeight - window.innerHeight;
        const progress = docHeight > 0 ? scrollTop / docHeight : 0;

        const pct = Math.min(1, Math.max(0, progress));
        const finalThreshold = 0.98; // A partir de aqu√≠ empieza la fase "WELCOME TO MARS"

        const scrollProgressEl = document.querySelector(".scroll-progress");

        // üîπMODO FINAL: s√≥lo WELCOME TO MARS (sin frames)
        if (pct >= finalThreshold) {
          // Ocultar todo lo dem√°s
          hero.style.opacity = 0;
          mainEl.style.opacity = 0;
          if (footer) footer.style.opacity = 0;
          if (scrollProgressEl) scrollProgressEl.style.opacity = 0;

          // Fase interna dentro del tramo final: 0 ‚Üí 1
          const finalRange = 1 - finalThreshold;
          let finalPhase = (pct - finalThreshold) / finalRange;
          finalPhase = Math.min(Math.max(finalPhase, 0), 1);

          // ‚ö†Ô∏è Retrasar la aparici√≥n:
          // hasta finalPhase ‚âà 0.6 ‚Üí NO se ve nada
          // de 0.6 a 1 ‚Üí empieza a subir y a hacerse visible
          const delay = 0.6; // cu√°nto tarda en empezar a aparecer
          const visiblePhase = Math.max(0, (finalPhase - delay) / (1 - delay)); // mapea 0.6‚Äì1 ‚Üí 0‚Äì1

          const startTop = 130; // muy abajo, fuera de pantalla
          const endTop = 50; // centro de la pantalla
          const currentTop = startTop + (endTop - startTop) * visiblePhase;

          if (finalMsg) {
            finalMsg.style.top = currentTop + "%";
            finalMsg.style.transform = "translate(-50%, -50%)";
            finalMsg.style.opacity = visiblePhase; // solo se ve en el √∫ltimo tramo
          }

          progressBarInner.style.width = `${pct * 100}%`;
          scrollLabel.textContent = "WELCOME TO MARS";

          return;
        }

        // MODO NORMAL: frames + t√≠tulo + footer, sin mensaje final
        if (finalMsg) {
          finalMsg.style.opacity = 0;
          finalMsg.style.top = "50%"; // reseteamos al centro para cuando vuelva
        }
        if (scrollProgressEl) scrollProgressEl.style.opacity = 1;

        // 1) HERO (t√≠tulo 404s to Mars) movi√©ndose del centro hacia arriba (r√°pido)
        const maxHeroScroll = window.innerHeight * 0.3; // sube r√°pido
        let t = Math.min(scrollTop / maxHeroScroll, 1); // 0 ‚Üí 1 pronto

        const startTopHero = 50; // %
        const endTopHero = 8; // %
        const topPercent = startTopHero + (endTopHero - startTopHero) * t;

        hero.style.top = `${topPercent}%`;
        hero.style.transform = "translate(-50%, -50%)";

        if (t > 0.7) {
          hero.classList.add("hero--compact");
        } else {
          hero.classList.remove("hero--compact");
        }

        // 2) Aparici√≥n de los FRAMES un poco despu√©s de que el t√≠tulo empiece a irse
        const tFrame = Math.max(0, (t - 0.2) / 0.8); // empieza a aparecer cuando t > 0.2

        mainEl.style.opacity = tFrame;
        mainEl.style.transform = `translateY(${40 * (1 - tFrame)}px)`;

        // 3) Frames de Obsidian seg√∫n porcentaje total de scroll
        const frameIndex = Math.floor(progress * frames.length);
        setFrame(frameIndex);

        // 4) Barra de progreso y texto
        progressBarInner.style.width = `${pct * 100}%`;
        scrollLabel.textContent =
          pct > 0.96 ? "WELCOME TO MARS" : "SCROLL TO CONTINUE";

        // 5) Fase final suave antes del corte al modo "WELCOME TO MARS"
        const endStart = 0.85;
        let endPhase = 0;
        if (pct > endStart) {
          endPhase = (pct - endStart) / (finalThreshold - endStart); // 0 -> 1
          endPhase = Math.min(Math.max(endPhase, 0), 1);
        }

        const extraOffset = -200 * endPhase;

        // Hero: se va hacia arriba y se difumina ligeramente antes del corte
        hero.style.transform = `translate(-50%, -50%) translateY(${extraOffset}px)`;
        hero.style.opacity = 1 - endPhase * 0.8;

        // Frames (cara+bocadillo): tambi√©n suben y se difuminan un poco
        const baseOffsetMain = 40 * (1 - tFrame);
        mainEl.style.transform = `translateY(${
          baseOffsetMain + extraOffset
        }px)`;
        mainEl.style.opacity = tFrame * (1 - endPhase * 0.9);

        // Footer se difumina un poco antes del corte
        if (footer) {
          footer.style.opacity = 1 - endPhase;
        }
      }

      // ‚≠ê STARFIELD
      let starCanvas, starCtx;
      let stars = [];
      const STAR_COUNT = 110;

      function initStarfield() {
        starCanvas = document.getElementById("starfield");
        if (!starCanvas) return;

        starCtx = starCanvas.getContext("2d");
        resizeStarfield();

        // Crear estrellas iniciales
        stars = [];
        for (let i = 0; i < STAR_COUNT; i++) {
          stars.push(makeStar());
        }

        requestAnimationFrame(animateStars);
      }

      function resizeStarfield() {
        if (!starCanvas) return;

        starCanvas.width = window.innerWidth;
        starCanvas.height = window.innerHeight;

        // üí´ Re-crear las estrellas para rellenar el nuevo tama√±o
        stars = [];
        for (let i = 0; i < STAR_COUNT; i++) {
          stars.push(makeStar());
        }
      }

      // Crea una estrella con posici√≥n, tama√±o y brillo aleatorio
      function makeStar() {
        const w = starCanvas.width;
        const h = starCanvas.height;
        const speedBase = 0.05;

        return {
          x: Math.random() * w,
          y: Math.random() * h,
          radius: Math.random() * 1.4 + 0.4, // tama√±o
          alpha: Math.random() * 0.7 + 0.3,
          twinkleSpeed:
            (Math.random() * 0.015 + 0.005) * (Math.random() < 0.5 ? 1 : -1),
          vx: (Math.random() * 0.03 + 0.02) * (Math.random() < 0.5 ? 1 : -1), // desplazamiento sutil
          vy: (Math.random() * 0.03 + 0.02) * (Math.random() < 0.5 ? 1 : -1),
        };
      }

      function animateStars() {
        if (!starCtx || !starCanvas) return;
        const w = starCanvas.width;
        const h = starCanvas.height;

        starCtx.clearRect(0, 0, w, h);

        for (let star of stars) {
          // Actualizar posici√≥n
          star.x += star.vx;
          star.y += star.vy;

          // Wrap-around para que vuelvan a aparecer por el otro lado
          if (star.x < -10) star.x = w + 10;
          if (star.x > w + 10) star.x = -10;
          if (star.y < -10) star.y = h + 10;
          if (star.y > h + 10) star.y = -10;

          // Twinkle (parpadeo suave)
          star.alpha += star.twinkleSpeed;
          if (star.alpha < 0.2 || star.alpha > 1) {
            star.twinkleSpeed *= -1;
            star.alpha = Math.max(0.2, Math.min(1, star.alpha));
          }

          // Dibujar estrella
          starCtx.save();
          starCtx.globalAlpha = star.alpha;
          const gradient = starCtx.createRadialGradient(
            star.x,
            star.y,
            0,
            star.x,
            star.y,
            star.radius * 3
          );
          gradient.addColorStop(0, "rgba(255,255,255,1)");
          gradient.addColorStop(0.4, "rgba(255,255,255,0.8)");
          gradient.addColorStop(1, "rgba(255,255,255,0)");
          starCtx.fillStyle = gradient;
          starCtx.beginPath();
          starCtx.arc(star.x, star.y, star.radius * 3, 0, Math.PI * 2);
          starCtx.fill();
          starCtx.restore();
        }

        requestAnimationFrame(animateStars);
      }

      window.addEventListener("resize", resizeStarfield);

      window.addEventListener("load", () => {
        initStarfield();
        setFrame(0);
        // Sin animaci√≥n de entrada autom√°tica: todo depende del scroll
        updateFromScroll(); // sincronizar estados iniciales
        window.addEventListener("scroll", updateFromScroll);
      });

      window.addEventListener("beforeunload", () => {
        window.scrollTo(0, 0);
      });

      window.addEventListener("load", () => {
        setTimeout(() => {
          window.scrollTo(0, 0);
        }, 0);
      });
    </script>
  </body>
</html>
